generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid())
  name        String
  email       String   @unique
  password    String
  createdAt   DateTime @default(now())
  tasks       Task[]
  timeEntries  TimeEntry[]
  prefs       UserPref?
}

model Task {
  id             String      @id @default(uuid())
  userId         String
  title          String
  description    String?
  isDone         Boolean     @default(false)
  isPinned       Boolean     @default(false)
  startAt        DateTime?
  dueAt          DateTime?
  estimatedMins  Int?
  orderRank      Float?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  user           User        @relation(fields: [userId], references: [id])
  subtasks       Subtask[]
  reminders      Reminder[]
  attachments    Attachment[]
  timeEntries    TimeEntry[]
}

model Subtask {
  id        String   @id @default(uuid())
  taskId    String
  title     String
  isDone    Boolean  @default(false)
  orderRank Float?
  task      Task     @relation(fields: [taskId], references: [id])
}

model Reminder {
  id        String   @id @default(uuid())
  taskId    String
  runAt     DateTime
  sentAt    DateTime?
  status    String   @default("pending")
  task      Task     @relation(fields: [taskId], references: [id])
}

model TimeEntry {
  id        String   @id @default(uuid())
  taskId    String
  userId    String
  startedAt DateTime
  stoppedAt DateTime?
  duration  Int?      // seconds
  task      Task      @relation(fields: [taskId], references: [id])
  user      User      @relation(fields: [userId], references: [id])
}

model Attachment {
  id        String   @id @default(uuid())
  taskId    String
  filename  String
  mime      String
  size      Int
  s3Key     String
  task      Task     @relation(fields: [taskId], references: [id])
}

model UserPref {
  id             String   @id @default(uuid())
  userId         String   @unique
  theme          String   @default("auto")
  language       String   @default("pt-BR")
  myDayMode      String   @default("auto")
  myDayWindow    Json?
  defaultRemindMins Int?  @default(15)
  user           User     @relation(fields: [userId], references: [id])
}